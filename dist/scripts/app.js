/**
 * @license
 *
 * Copyright (c) 2015, University of Washington Interactive Data Lab.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * * Neither the name of the University of Washington Interactive Data Lab
 *   nor the names of its contributors may be used to endorse or promote products
 *   derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";angular.module("voyager2",["vlui","ngSanitize","ngTouch","ngDragDrop","zeroclipboard","Chronicle","LocalStorageModule","720kb.tooltips","ngOrderObjectBy","angular-google-analytics"]).constant("_",window._).constant("vg",window.vg).constant("cql",window.cql).constant("ZSchema",window.ZSchema).constant("Tether",window.Tether).constant("Drop",window.Drop).constant("Blob",window.Blob).constant("URL",window.URL).constant("jsondiffpatch",window.jsondiffpatch).config(["consts",function(e){window.vg.util.extend(e,{appId:"voyager2",initialSpec:window.initialSpec||void 0,debugInList:!1,logLevel:"DEBUG",logToWebSql:!0,maxAnyShelf:4})}]).config(["vl",function(e){e.config.defaultConfig.countTitle="COUNT"}]).config(["uiZeroclipConfigProvider",function(e){e.setZcConf({swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("voyager2")}]).config(["AnalyticsProvider","consts",function(e,t){t.embeddedData||e.setAccount({tracker:"UA-44428446-4",name:"voyager2",trackEvent:!0})}]),angular.module("voyager2").directive("vgSpecEditor",["Spec",function(e){return{templateUrl:"components/vgSpecEditor/vgSpecEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e}}}]),angular.module("voyager2").directive("nullFilterDirective",["Spec",function(e){return{templateUrl:"components/nullfilterdirective/nullfilterdirective.html",restrict:"E",scope:{},link:function(t,n,r){t.Spec=e,t.updateFilter=function(){e.update()}}}}]),angular.module("voyager2").directive("lyraExport",function(){return{template:'<a href="#" class="command" ng-click="export()">Export to lyra</a>',restrict:"E",replace:!0,scope:{},controller:["$scope","$timeout","Spec","Alerts",function(e,t,n,r){e["export"]=function(){var e=n.vgSpec;e||r.add("No vega spec present."),e.marks[0]["lyra.groupType"]="layer";var a="http://idl.cs.washington.edu/projects/lyra/app/",i=window.open(a,"_blank");t(function(){r.add("Please check whether lyra loaded the vega spec correctly. This feature is experimental and may not work.",5e3),i.postMessage({spec:e},a)},5e3)}}]}}),angular.module("voyager2").directive("jsonInput",["JSON3",function(e){return{restrict:"A",require:"ngModel",scope:{},link:function(t,n,r,a){var i=function(t){return e.stringify(t,null,"  ",80)};a.$formatters.push(i)}}}]),angular.module("voyager2").directive("guideMenu",function(){return{templateUrl:"components/guidemenu/guideMenu.html",restrict:"E",scope:{prop:"=",initialLimit:"<",priority:"<"},replace:!0,controller:["$scope","PCAplot",function(e,t){e.limit=e.initialLimit||4,e.marks=["tick","bar","area","boxplot"],e.props=["PCA1","skewness","outlier","PCA2"],e.typeChange=function(){t.updateSpec(e.prop)},e.previewSlider=function(t){e.prop.pos=t},e.markChange=function(){t.updateSpec(e.prop)};var n=e.$watch("prop",function(e){},!0);e.$on("$destroy",function(){n()})}]}}),angular.module("voyager2").directive("guidePlot",["PCAplot",function(e){return{templateUrl:"components/d3-guideplot/guide-plot.html",replace:!0,restrict:"E",scope:{pcaDefs:"<"},link:function(e){}}}]),angular.module("voyager2").directive("gPlot",["PCAplot",function(e){return{templateUrl:"components/d3-guideplot/gplot.html",replace:!0,scope:{pcaDef:"="},link:function(t,n){t.PCAplot=e,d3.select(n[0]).select("svg").attr("width",n.width()).attr("height",n.height()),e.plotguide(d3.select(n[0]).select("svg"),t.pcaDef[0],t.pcaDef[1])},controller:["$scope",function(e){console.log("me")}]}}]),function(){function e(e){return[0,e.length-1]}function t(e){return[d3.quantile(e,.25),d3.quantile(e,.5),d3.quantile(e,.75)]}d3.box=function(){function n(e){e.each(function(e,t){var n=e[1].sort(d3.ascending),c=d3.select(this),p=n.length,f=n[0],g=n[p-1],h=n.quartiles=s(n),m=l&&l.call(this,n,t),y=m&&m.map(function(e){return n[e]}),v=m?d3.range(0,m[0]).concat(d3.range(m[1]+1,p)):d3.range(p),S=d3.scale.linear().domain(o&&o.call(this,n,t)||[f,g]).range([a,0]),b=this.__chart__||d3.scale.linear().domain([0,1/0]).range(S.range());this.__chart__=S;var w=c.selectAll("line.center").data(y?[y]:[]);w.enter().insert("line","rect").attr("class","center").attr("x1",r/2).attr("y1",function(e){return b(e[0])}).attr("x2",r/2).attr("y2",function(e){return b(e[1])}).style("opacity",1e-6).transition().duration(i).style("opacity",1).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}),w.transition().duration(i).style("opacity",1).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}),w.exit().transition().duration(i).style("opacity",1e-6).attr("y1",function(e){return S(e[0])}).attr("y2",function(e){return S(e[1])}).remove();var x=c.selectAll("rect.box").data([h]);x.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(e){return b(e[2])}).attr("width",r).attr("height",function(e){return b(e[0])-b(e[2])}).transition().duration(i).attr("y",function(e){return S(e[2])}).attr("height",function(e){return S(e[0])-S(e[2])}),x.transition().duration(i).attr("y",function(e){return S(e[2])}).attr("height",function(e){return S(e[0])-S(e[2])});var E=c.selectAll("line.median").data([h[1]]);E.enter().append("line").attr("class","median").attr("x1",0).attr("y1",b).attr("x2",r).attr("y2",b).transition().duration(i).attr("y1",S).attr("y2",S),E.transition().duration(i).attr("y1",S).attr("y2",S);var k=c.selectAll("line.whisker").data(y||[]);k.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",b).attr("x2",0+r).attr("y2",b).style("opacity",1e-6).transition().duration(i).attr("y1",S).attr("y2",S).style("opacity",1),k.transition().duration(i).attr("y1",S).attr("y2",S).style("opacity",1),k.exit().transition().duration(i).attr("y1",S).attr("y2",S).style("opacity",1e-6).remove();var A=c.selectAll("circle.outlier").data(v,Number);A.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",r/2).attr("cy",function(e){return b(n[e])}).style("opacity",1e-6).transition().duration(i).attr("cy",function(e){return S(n[e])}).style("opacity",1),A.transition().duration(i).attr("cy",function(e){return S(n[e])}).style("opacity",1),A.exit().transition().duration(i).attr("cy",function(e){return S(n[e])}).style("opacity",1e-6).remove();var C=d||S.tickFormat(8),T=c.selectAll("text.box").data(h);1==u&&T.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(e,t){return 1&t?6:-6}).attr("x",function(e,t){return 1&t?+r:0}).attr("y",b).attr("text-anchor",function(e,t){return 1&t?"start":"end"}).text(C).transition().duration(i).attr("y",S),T.transition().duration(i).text(C).attr("y",S);var P=c.selectAll("text.whisker").data(y||[]);1==u&&P.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",r).attr("y",b).text(C).style("opacity",1e-6).transition().duration(i).attr("y",S).style("opacity",1),P.transition().duration(i).text(C).attr("y",S).style("opacity",1),P.exit().transition().duration(i).attr("y",S).style("opacity",1e-6).remove()}),d3.timer.flush()}var r=1,a=1,i=0,o=null,c=Number,l=e,s=t,u=!0,d=null;return n.width=function(e){return arguments.length?(r=e,n):r},n.height=function(e){return arguments.length?(a=e,n):a},n.tickFormat=function(e){return arguments.length?(d=e,n):d},n.duration=function(e){return arguments.length?(i=e,n):i},n.domain=function(e){return arguments.length?(o=null==e?e:d3.functor(e),n):o},n.value=function(e){return arguments.length?(c=e,n):c},n.whiskers=function(e){return arguments.length?(l=e,n):l},n.showLabels=function(e){return arguments.length?(u=e,n):u},n.quartiles=function(e){return arguments.length?(s=e,n):s},n}}(),angular.module("voyager2").directive("slideGraph",function(){return{templateUrl:"components/d3-slidegraph/slide-graph.html",replace:!0,scope:{charts:"<",pos:"=",postSelectAction:"&"},link:function(e,t){function n(){a.style("transform","translate3d(0,"+-e.pos*a.node().offsetHeight+"px,0)")}var r=e.charts.length,a=d3.select(".items-slider");e.$watch("pos",function(){n()},!0),e.prev=function(){e.pos=Math.max(e.pos-1,0),n()},e.next=function(){e.pos=Math.min(e.pos+1,r-1),n()},e.$on("$destroy",function(){console.log("guideplot destroyed"),e.charts=null})}}}),angular.module("voyager2").directive("slideCom",function(){return{templateUrl:"components/d3-slidegraph/slide-com.html",replace:!0,scope:{chart:"="},link:function(e,t){}}});var PCA=function(){function e(e){var n=t(e);return n.map(function(t){return d3.sum(t)/e.length})}function t(e){return d3.range(e[0].length).map(function(t){return e.map(function(e){return e[t]})})}function n(e,n){return e.map(function(e){return t(n).map(function(t){return d3.sum(d3.zip(e,t).map(function(e){return e[0]*e[1]}))})})}function r(e){return d3.range(e.length).map(function(t){return d3.range(e.length).map(function(n){return t===n?e[t]:0})})}function a(e,t){return d3.range(e).map(function(e){return d3.range(t).map(function(){return 0})})}function i(e,t){return e.map(function(e){return e.map(function(e){return e<t?0:e})})}function o(e,t){return d3.zip(e,t).map(function(e){return d3.zip(e[0],e[1]).map(function(e){return e[0]===e[1]})}).map(function(e){return e.reduce(function(e,t){return e*t})}).reduce(function(e,t){return e*t})}function c(t){e(t);return l(e(s(t,t)))}function l(e){return e.map(function(e){return Math.sqrt(e)})}function s(e,t){return d3.zip(e,t).map(function(e){return"number"==typeof e[0]?e[0]*e[1]:d3.zip(e[0],e[1]).map(function(e){return e[0]*e[1]})})}function u(e,t){return console.assert(e.length===t.length,"dim(x) == dim(y)"),d3.zip(e,t).map(function(e){return"number"==typeof e[0]?e[0]-e[1]:d3.zip(e[0],e[1]).map(function(e){return e[0]-e[1]})})}function d(e,t){return console.assert(e.length===t.length,"dim(x) == dim(y)"),d3.zip(e,t).map(function(e){return 0!==e[1]?e[0]/e[1]:0})}function p(t,n,r){if(n){var a=e(t);t=t.map(function(e){return u(e,a)})}if(r){var i=c(t);t=t.map(function(e){return d(e,i)})}return t}function f(e){function t(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):0===t?e:t*Math.sqrt(1+e*e/t/t)}var n,r=Math.pow(2,-52),i=1e-64/r,o=50,c=0,l=0,s=0,u=0,d=0,p=e.map(function(e){return e.slice(0)}),f=p.length,g=p[0].length;console.assert(f>=g,"Need more rows than columns");var h=d3.range(g).map(function(){return 0}),m=d3.range(g).map(function(){return 0}),y=a(g,g),v=0,S=0,b=0,w=0,x=0,E=0,k=0;for(l=0;l<g;l++){for(h[l]=S,k=0,d=l+1,s=l;s<f;s++)k+=p[s][l]*p[s][l];if(k<=i)S=0;else for(v=p[l][l],S=Math.sqrt(k),v>=0&&(S=-S),b=v*S-k,p[l][l]=v-S,s=d;s<g;s++){for(k=0,u=l;u<f;u++)k+=p[u][l]*p[u][s];for(v=k/b,u=l;u<f;u++)p[u][s]+=v*p[u][l]}for(m[l]=S,k=0,s=d;s<g;s++)k+=p[l][s]*p[l][s];if(k<=i)S=0;else{for(v=p[l][l+1],S=Math.sqrt(k),v>=0&&(S=-S),b=v*S-k,p[l][l+1]=v-S,s=d;s<g;s++)h[s]=p[l][s]/b;for(s=d;s<f;s++){for(k=0,u=d;u<g;u++)k+=p[s][u]*p[l][u];for(u=d;u<g;u++)p[s][u]+=k*h[u]}}x=Math.abs(m[l])+Math.abs(h[l]),x>w&&(w=x)}for(l=g-1;l!==-1;l+=-1){if(0!==S){for(b=S*p[l][l+1],s=d;s<g;s++)y[s][l]=p[l][s]/b;for(s=d;s<g;s++){for(k=0,u=d;u<g;u++)k+=p[l][u]*y[u][s];for(u=d;u<g;u++)y[u][s]+=k*y[u][l]}}for(s=d;s<g;s++)y[l][s]=0,y[s][l]=0;y[l][l]=1,S=h[l],d=l}for(l=g-1;l!==-1;l+=-1){for(d=l+1,S=m[l],s=d;s<g;s++)p[l][s]=0;if(0!==S){for(b=p[l][l]*S,s=d;s<g;s++){for(k=0,u=d;u<f;u++)k+=p[u][l]*p[u][s];for(v=k/b,u=l;u<f;u++)p[u][s]+=v*p[u][l]}for(s=l;s<f;s++)p[s][l]=p[s][l]/S}else for(s=l;s<f;s++)p[s][l]=0;p[l][l]+=1}for(r*=w,u=g-1;u!==-1;u+=-1)for(var A=0;A<o;A++){var C=!1;for(d=u;d!==-1;d+=-1){if(Math.abs(h[d])<=r){C=!0;break}if(Math.abs(m[d-1])<=r)break}if(!C){c=0,k=1;var T=d-1;for(l=d;l<u+1&&(v=k*h[l],h[l]=c*h[l],!(Math.abs(v)<=r));l++)for(S=m[l],b=t(v,S),m[l]=b,c=S/b,k=-v/b,s=0;s<f;s++)x=p[s][T],E=p[s][l],p[s][T]=x*c+E*k,p[s][l]=-x*k+E*c}if(E=m[u],d===u){if(E<0)for(m[u]=-E,s=0;s<g;s++)y[s][u]=-y[s][u];break}for(console.assert(A<o-1,"Error: no convergence."),w=m[d],x=m[u-1],S=h[u-1],b=h[u],v=((x-E)*(x+E)+(S-b)*(S+b))/(2*b*x),S=t(v,1),v=v<0?((w-E)*(w+E)+b*(x/(v-S)-b))/w:((w-E)*(w+E)+b*(x/(v+S)-b))/w,c=1,k=1,l=d+1;l<u+1;l++){for(S=h[l],x=m[l],b=k*S,S=c*S,E=t(v,b),h[l-1]=E,c=v/E,k=b/E,v=w*c+S*k,S=-w*k+S*c,b=x*k,x*=c,s=0;s<g;s++)w=y[s][l-1],E=y[s][l],y[s][l-1]=w*c+E*k,y[s][l]=-w*k+E*c;for(E=t(v,b),m[l-1]=E,c=v/E,k=b/E,v=c*S+k*x,w=-k*S+c*x,s=0;s<f;s++)x=p[s][l-1],E=p[s][l],p[s][l-1]=x*c+E*k,p[s][l]=-x*k+E*c}h[d]=0,h[u]=v,m[u]=w}for(l=0;l<m.length;l++)m[l]<r&&(m[l]=0);for(l=0;l<g;l++)for(s=l-1;s>=0;s--)if(m[s]<m[l]){for(c=m[s],m[s]=m[l],m[l]=c,u=0;u<p.length;u++)n=p[u][l],p[u][l]=p[u][s],p[u][s]=n;for(u=0;u<y.length;u++)n=y[u][l],y[u][l]=y[u][s],y[u][s]=n;l=s}return{U:p,S:m,V:y}}function g(e,t){var c=f(e),l=c.U,s=r(c.S),d=c.V,p=n(e,d),g=n(l,s),h=i(u(p,g),1e-12),m=a(h.length,h[0].length);console.assert(o(h,m),"svd and eig ways must be the same.");var y=[0,1];for(var v in c.S)c.S[v]>=c.S[y[0]]?y[0]=parseInt(v):c.S[v]>=c.S[y[1]]&&(y[1]=parseInt(v));return[g,d,y]}this.scale=p,this.pca=g};
// Copyright (c) 2013 Justin Palmer
// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete
// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz
//
// Tooltips for d3.js SVG visualizations
d3.functor=function(e){return"function"==typeof e?e:function(){return e}},d3.tip=function(){function e(e){b=f(e),w=b.createSVGPoint(),document.body.appendChild(S)}function t(){return"n"}function n(){return[0,0]}function r(){return" "}function a(){var e=h();return{top:e.n.y-S.offsetHeight,left:e.n.x-S.offsetWidth/2}}function i(){var e=h();return{top:e.s.y,left:e.s.x-S.offsetWidth/2}}function o(){var e=h();return{top:e.e.y-S.offsetHeight/2,left:e.e.x}}function c(){var e=h();return{top:e.w.y-S.offsetHeight/2,left:e.w.x-S.offsetWidth}}function l(){var e=h();return{top:e.nw.y-S.offsetHeight,left:e.nw.x-S.offsetWidth}}function s(){var e=h();return{top:e.ne.y-S.offsetHeight,left:e.ne.x}}function u(){var e=h();return{top:e.sw.y,left:e.sw.x-S.offsetWidth}}function d(){var e=h();return{top:e.se.y,left:e.e.x}}function p(){var e=d3.select(document.createElement("div"));return e.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),e.node()}function f(e){return e=e.node(),"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement}function g(){return null===S&&(S=p(),document.body.appendChild(S)),d3.select(S)}function h(){for(var e=x||d3.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var t={},n=e.getScreenCTM(),r=e.getBBox(),a=r.width,i=r.height,o=r.x,c=r.y;return w.x=o,w.y=c,t.nw=w.matrixTransform(n),w.x+=a,t.ne=w.matrixTransform(n),w.y+=i,t.se=w.matrixTransform(n),w.x-=a,t.sw=w.matrixTransform(n),w.y-=i/2,t.w=w.matrixTransform(n),w.x+=a,t.e=w.matrixTransform(n),w.x-=a/2,w.y-=i/2,t.n=w.matrixTransform(n),w.y+=i,t.s=w.matrixTransform(n),t}var m=t,y=n,v=r,S=p(),b=null,w=null,x=null;e.show=function(){var t=Array.prototype.slice.call(arguments);t[t.length-1]instanceof SVGElement&&(x=t.pop());var n,r=v.apply(this,t),a=y.apply(this,t),i=m.apply(this,t),o=g(),c=k.length,l=document.documentElement.scrollTop||document.body.scrollTop,s=document.documentElement.scrollLeft||document.body.scrollLeft;for(o.html(r).style("position","absolute").style("opacity",1).style("pointer-events","all");c--;)o.classed(k[c],!1);return n=E[i].apply(this),o.classed(i,!0).style("top",n.top+a[0]+l+"px").style("left",n.left+a[1]+s+"px"),e},e.hide=function(){var t=g();return t.style("opacity",0).style("pointer-events","none"),e},e.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return g().attr(t);var r=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(g(),r),e},e.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return g().style(t);var r=Array.prototype.slice.call(arguments);if(1===r.length){var a=r[0];Object.keys(a).forEach(function(e){return d3.selection.prototype.style.apply(g(),[e,a[e]])})}return e},e.direction=function(t){return arguments.length?(m=null==t?t:d3.functor(t),e):m},e.offset=function(t){return arguments.length?(y=null==t?t:d3.functor(t),e):y},e.html=function(t){return arguments.length?(v=null==t?t:d3.functor(t),e):v},e.destroy=function(){return S&&(g().remove(),S=null),e};var E={n:a,s:i,e:o,w:c,nw:l,ne:s,sw:u,se:d},k=Object.keys(E);return e},angular.module("voyager2").component("biPlot",{templateUrl:"components/d3-biplot/bi-plot.html",controller:["$scope",function(e){d3.selectAll(".background-biplot").style("fill","#ffffff").attr("width",$(".biplot").width()).attr("height",$(".biplot").width())}]}),angular.module("voyager2").directive("cqlQueryEditor",["Spec",function(e){return{templateUrl:"components/cqlQueryEditor/cqlQueryEditor.html",restrict:"E",scope:{},link:function(t){t.Spec=e}}}]),angular.module("voyager2").directive("configurationEditor",function(){return{templateUrl:"components/configurationeditor/configurationeditor.html",restrict:"E",scope:{},controller:["$scope","Config",function(e,t){e.Config=t}]}}),angular.module("voyager2").service("Wildcards",["ANY","vl","cql","Dataset","Alerts",function(e,t,n,r,a){function i(){d.list=[{title:"Categorical Fields",field:"?",type:{"enum":[t.type.NOMINAL,t.type.ORDINAL]},immutable:!0},{title:"Temporal Fields",field:"?",type:t.type.TEMPORAL,immutable:!0},{title:"Quantitative Fields",field:"?",type:t.type.QUANTITATIVE,immutable:!0}]}function o(e){var t={title:null,field:{"enum":[]},type:{"enum":[]}};return l(t,e,!0),d.list.push(t),t}function c(e,t){e.indexOf(t)===-1&&e.push(t)}function l(e,i,o){if(o)n.enumSpec.isEnumSpec(i.type)?i.type["enum"].forEach(function(t){c(e.type["enum"],t)}):c(e.type["enum"],i.type);else if(n.enumSpec.isEnumSpec(i.type)){var l=t.util.some(i.type["enum"],function(n){return!t.util.contains(e.type["enum"],n)});if(l)return void a.add("Cannot create a wildcard that mixes multiple types")}else if(!t.util.contains(e.type["enum"],i.type))return void a.add("Cannot create a wildcard that mixes multiple types");return n.enumSpec.isEnumSpec(i.field)?i.field["enum"]?i.field["enum"].forEach(function(t){c(e.field["enum"],t)}):r.schema.fieldSchemas.forEach(function(n){(e.type["enum"]?t.util.contains(e.type["enum"],n.type):n.type===e.type)&&c(e.field["enum"],n.field)}):"count"===i.aggregate?(e.aggregate={"enum":[void 0,"count"]},c(e.field["enum"],"*")):c(e.field["enum"],i.field),e}function s(e){var t=d.list.indexOf(e);d.list.splice(t,1)}function u(e,t){var n=e.field["enum"].splice(t,1);"*"===n&&delete e.aggregate,0===e.field["enum"].length&&s(e)}var d={list:null,addItem:o,addField:l,removeItem:s,removeField:u};return i(),r.onUpdate.push(i),d}]),angular.module("voyager2").service("Spec",["ANY","_","vg","vl","cql","util","ZSchema","consts","NotifyingService","Alerts","Alternatives","Chart","Config","Dataset","Logger","Pills","Schema","Wildcards","FilterManager","PCAplot",function(e,t,n,r,a,i,o,c,l,s,u,d,p,f,g,h,m,y,v,S){function b(){return{data:p.data,transform:{filterInvalid:void 0},mark:e,encoding:D.reduce(function(e,t){return e[t]={},e},{}),config:p.config,groupBy:"auto",autoAddCount:!1}}function w(e){for(var r in e)t.isObject(e[r])&&w(e[r]),(null===e[r]||void 0===e[r]||t.isObject(e[r])&&0===n.util.keys(e[r]).length&&"bin"!==r||e[r]===[])&&delete e[r]}function x(e){var n=i.duplicate(e),a=null;if(n){a=(n.transform||{}).filter;var o=t.omit(n.transform||{},"filter");n=t.omit(n,"transform"),o&&(n.transform=o)}var c=r.util.mergeDeep(b(),n);return c.transform.filter=v.reset(a),c}function E(e,t){if(!e)return t;var n=e.enumSpecIndex;return 0===i.keys(n.encodingIndicesByProperty).length}function k(t,r){if(r){t=i.duplicate(t),t.transform&&t.transform.filter&&delete t.transform.filter;var o=v.getVlFilter();o&&(t.transform=t.transform||{},t.transform.filter=o)}return{data:p.data,mark:t.mark===e?"?":t.mark,transform:t.transform,encodings:n.util.keys(t.encoding).reduce(function(e,r){var i=n.util.extend({channel:h.isAnyChannel(r)?"?":r},t.encoding[r],{title:void 0});return a.enumSpec.isEnumSpec(i.field)&&(i.field={name:"f"+r,"enum":i.field["enum"]}),e.push(i),e},[]),config:t.config}}function A(n){var o=i.duplicate(n.spec),c=b();a.enumSpec.isEnumSpec(o.mark)?c.mark=e:c.mark=o.mark,c.transform=t.omit(o.transform||{},"filter"),c.transform.filter=v.reset(o.transform.filter);var l=0,s=o.encodings.reduce(function(t,n){var r=a.enumSpec.isEnumSpec(n.channel)?e+l++:n.channel;return t[r]=n,t},{});return c.encoding=r.util.mergeDeep(c.encoding,s),c.config=o.config,c.groupBy="auto",c.autoAddCount=(n.config||{}).autoAddCount,c}function C(e,t){for(var n=k(e,t),r=!1,i=!1,o=!1,c=0;c<n.encodings.length;c++){var l=n.encodings[c];l.autoCount!==!1&&(a.enumSpec.isEnumSpec(l.field)&&(r=!0),(a.enumSpec.isEnumSpec(l.aggregate)||a.enumSpec.isEnumSpec(l.bin)||a.enumSpec.isEnumSpec(l.timeUnit))&&(i=!0),a.enumSpec.isEnumSpec(l.channel)&&(o=!0))}var s=e.groupBy;return"auto"===e.groupBy&&(s=O.autoGroupBy=r?i?"fieldTransform":"field":"encoding"),{spec:n,groupBy:s,orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{omitTableWithOcclusion:!1,autoAddCount:(r||i||o)&&e.autoAddCount}}}function T(e){return{}}function P(e,t,n){var a=t.type,i=h.isAnyChannel(n)?{measure:!0,dimension:!0}:r.channel.getSupportedRole(n),o=i.dimension&&!i.measure;t.field&&o?"count"===t.aggregate?t={}:a!==r.type.QUANTITATIVE||t.bin?a!==r.type.TEMPORAL||t.timeUnit||(t.timeUnit=c.defaultTimeFn):(t.aggregate=void 0,t.bin={maxbins:r.bin.MAXBINS_DEFAULT}):t.field||(t={});var l=T(n),s=m.getChannelSchema(n).properties;for(var u in s)t[u]&&("value"===u&&t.field?delete l[u]:l[u]=t[u]);e[n]=l}function M(e){var t=h.getNextAnyChannelId();null!==t&&P(e,{},t)}var D=t.keys(m.schema.definitions.Encoding.properties).concat([e+0]),O={spec:null,previewedSpec:null,emptySpec:b(),query:null,isSpecific:!0,charts:null,chart:d.getChart(null),isEmptyPlot:!0,alternatives:[],histograms:null,instantiate:b,groupByLabel:{field:"Showing views with different fields",fieldTransform:"Showing views with different fields and transforms",encoding:"Showing views with different encodings"},autoGroupBy:null};return O._removeEmptyFieldDefs=function(e){e.encoding=t.omit(e.encoding,function(t,n){return!t||void 0===t.field&&void 0===t.value||e.mark&&!r.channel.supportMark(n,e.mark)})},O.parseSpec=function(e){O.spec=x(e)},O.reset=function(e){var t=b();t.transform.filter=v.reset(null,e),O.spec=t},O.update=function(e){e=t.cloneDeep(e||O.spec),O._removeEmptyFieldDefs(e),w(e),e.transform&&e.transform.filter&&delete e.transform.filter,e.transform=e.transform||{};var r=v.getVlFilter();if((r||e.transform.filter)&&(e.transform.filter=r),"encoding"in e||(e.encoding={}),"config"in e||(e.config={}),n.util.extend(e.config,p.small()),!f.schema)return O;var i=O.cleanQuery=C(e);if(t.isEqual(i,O.oldCleanQuery))return O;O.oldCleanQuery=t.cloneDeep(i);var o=a.query(i,f.schema);O.query=o.query;var c=o.result.getTopSpecQueryModel();return O.isEmptyPlot=!O.query||0===O.query.spec.encodings.length,O.isSpecific=E(c,O.isEmptyPlot),O.alternatives=[],O.isSpecific||O.isEmptyPlot?(O.chart=d.getChart(c),O.charts=null,f.schema&&(i.spec.encodings.length>0?O.alternatives=u.getAlternatives(i,O.chart,c):O.alternatives=u.getHistograms(i,O.chart,c))):c?(O.charts=o.result.items.map(d.getChart),O.chart=d.getChart(null)):(O.charts=null,O.chart=null),O},O.preview=function(e,t,n){if(e){if(!t)return;var r=t.vlSpec;O.previewedSpec=x(r),g.logInteraction(g.actions.SPEC_PREVIEW_ENABLED,t.shorthand,{list:n})}else null!==O.previewedSpec&&(O.previewedSpec=null,g.logInteraction(g.actions.SPEC_PREVIEW_DISABLED,t.shorthand,{list:n}))},O.previewQuery=function(e,t,n){if(e){if(!t)return;O.previewedSpec=A(t),g.logInteraction(g.actions.SPEC_PREVIEW_ENABLED,a.query.shorthand.spec(t.spec),{list:n})}else null!==O.previewedSpec&&(O.previewedSpec=null,g.logInteraction(g.actions.SPEC_PREVIEW_DISABLED,a.query.shorthand.spec(t.spec),{list:n}))},h.listener={set:function(e,t){P(O.spec.encoding,t,e)},remove:function(e){if(h.isAnyChannel(e)){delete O.spec.encoding[e];var t=h.getEmptyAnyChannelId();t||M(O.spec.encoding)}else P(O.spec.encoding,{},e)},add:function(n){var r=a.enumSpec.isEnumSpec(O.cleanQuery.spec.mark);if(g.logInteraction(g.actions.ADD_FIELD,n,{from:a.query.shorthand.spec(O.query.spec)}),O.isSpecific&&!a.enumSpec.isEnumSpec(n.field)){var i=O.cleanQuery.spec,o=t.extend({},n,{channel:a.enumSpec.SHORT_ENUM_SPEC},"count"===n.aggregate?{}:{aggregate:a.enumSpec.SHORT_ENUM_SPEC,bin:a.enumSpec.SHORT_ENUM_SPEC,timeUnit:a.enumSpec.SHORT_ENUM_SPEC});i.encodings.push(o);var c={spec:i,groupBy:["field","aggregate","bin","timeUnit","stack"],orderBy:"aggregationQuality",chooseBy:"effectiveness",config:{omitTableWithOcclusion:!1}},l=a.query(c,f.schema),u=l.result,d=u.getTopSpecQueryModel();if(!d)return void s.add("Cannot automatically adding this field anymore");var p=d.toSpec();r&&(p.mark=e),O.parseSpec(p)}else{var m=t.clone(O.spec.encoding),y=h.getEmptyAnyChannelId();if(!y)return void s.add("You cannot add too many fields to the wildcard shelves!");P(m,t.clone(n),y),M(m),O.spec.encoding=m}},select:function(t){var n=k(t);n.mark="?";var r=i.duplicate(n);delete r.config.cell;var o={spec:r,chooseBy:"effectiveness"},c=a.query(o,f.schema),l=c.result;l.getTopSpecQueryModel().getMark()===t.mark&&(t=i.duplicate(t),t.mark=e),O.parseSpec(t)},selectQuery:function(e){O.spec=A(e)},parse:function(e){O.parseSpec(e)},preview:O.preview,previewQuery:O.previewQuery,update:function(e){var t=0,n=[];for(var r in e.encoding)void 0!=e.encoding[r].field&&"*"!=e.encoding[r].field&&(t++,n.push(e.encoding[r].field));var a;if(0==t&&(a=f.data),1==t&&(S.calscagnotic(n),a=f.schema.fieldSchema(n[0]).scag),2==t){S.calscagnotic(n),console.log("HEREEEEEEE!");var i=f.schema.fieldSchema(n[0]).scag[n[1]];console.log("1. Outlying score: "+i.outlyingScore+", outlying edge cut point: "+i.outlyingUpperBound),console.log("2. Skewed score: "+i.skewedScore),console.log("3. Sparse score: "+i.sparseScore),console.log("4. Clumpy score: "+i.clumpyScore),console.log("5. Striated score: "+i.striatedScore),console.log("6. Convex score: "+i.convexScore),console.log("7. Skinny score: "+i.skinnyScore),console.log("8. Stringy score: "+i.stringyScore),console.log("9. Monotonic score: "+i.monotonicScore)}return S.mainfield!=n[0]&&(S.firstrun=!0,S.mainfield=n[0]),S.plot(a,t),O.update(e)},reset:function(){O.reset()},dragDrop:function(e,n){var r=t.clone(O.spec.encoding);n&&(h.isAnyChannel(n)&&!h.isAnyChannel(e)?delete r[n]:P(r,h.get(n)||{},n));var a=!(r[e]||{}).field;P(r,h.get(e)||{},e),h.isAnyChannel(e)&&a&&(n&&h.isAnyChannel(n)||M(r)),O.spec.encoding=r},rescale:function(e,t){var n=O.spec.encoding[e];n.scale?n.scale.type=t:n.scale={type:t}},sort:function(e,t){O.spec.encoding[e].sort=t},transpose:function(){d.transpose(O.spec)},isEnumeratedChannel:function(e){return O.spec.encoding[e]&&!O.spec.encoding[e].field},isEnumeratedField:function(e){return O.spec.encoding[e]&&a.enumSpec.isEnumSpec(O.spec.encoding[e].field)},toggleFilterInvalid:function(){O.spec.transform.filterInvalid=!O.spec.transform.filterInvalid||void 0},addWildcard:y.addItem,addWildcardField:y.addField,removeWildcard:y.removeItem,removeWildcardField:y.removeField},O.reset(),f.onUpdate.push(function(){O.reset(!0)}),O}]),angular.module("voyager2").factory("NotifyingService",["$rootScope",function(e){return{subscribe:function(t,n){var r=e.$on("notifying-service-event",n);t.$on("$destroy",r)},notify:function(){e.$emit("notifying-service-event")}}}]),angular.module("voyager2").factory("PCAplot",["ANY","Dataset","_","vg","vl","cql","ZSchema","consts","FilterManager","Pills","NotifyingService","Alternatives","Chart","Config","Schema","util","GuidePill",function(e,t,n,r,a,i,o,c,l,s,u,d,p,f,g,h,m){function y(){return{data:f.data,transform:{},mark:"bar",encoding:_.reduce(function(e,t){return e[t]={},e},{}),config:f.config,groupBy:"auto",autoAddCount:!1}}function v(e,t,n){var r=e.x,a=e.y,i=t.x,o=t.y,c=n.x,l=n.y,s=i-r,u=o-a,d=s*s+u*u,p=((c-r)*s+(l-a)*u)/d,f=r+p*s,g=a+p*u,f=r+p*s,g=a+p*u;return{x:f,y:g}}function S(e,t,n){var r=Math.sqrt(e*e+t*t),a=Math.atan(t/e);return e<0&&(a+=Math.PI),{x:r*Math.cos(a+n),y:r*Math.sin(a+n)}}function b(e){var t={};for(var n in e[0])t[n]=[];var r=Array.from(e);e.forEach(function(e){for(var n in e)void 0==t[n].find(function(t){return t.key==[e[n]]})&&t[n].push({key:e[n]})});for(var n in t)t[n].sort(function(e,t){return e.key<t.key?-1:1}),t[n].forEach(function(e,t){null==e.key?e.newindex=0:isNaN(parseFloat(e.key))?e.newindex=t:e.newindex=parseFloat(e.key)});var a=e.map(function(e,n){return Object.keys(e).map(function(e){return t[e].find(function(t){return t.key==r[n][e]}).newindex})});return a}function w(e,r){var a=a=n.cloneDeep(y()||U.spec);switch(a.config={cell:{width:200,height:30},axis:{grid:!1,ticks:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},r){case"PCA1":A(a,e);break;case"outlier":T(a,e);break;case"PCA2":C(a,e);break;case"skewness":k(a,e)}var o=P(a),c=i.query(o,t.schema);U.query=c.query;var l=c.result.getTopSpecQueryModel();U.chart=p.getChart(l),U.chart.prop={mspec:a,type:r,mark:x(r),ranking:E(r),plot:N},U.chart.guideon=function(e){e.charts=t.schema.fieldSchemas.sort(e.ranking).map(function(t){return e.plot(t,e.mark,e.mspec)}),e.previewcharts=e.charts.map(function(e){var t=n.cloneDeep(e);return t.vlSpec.config={cell:{width:100,height:30},axis:{grid:!1,ticks:!1,labels:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},t}),e.pos=0,U.updateguide(e)},U.charts.push(U.chart)}function x(e){switch(e){case"PCA1":return"tick";case"outlier":return"boxplot";case"PCA2":return"area";case"skewness":return"bar"}}function E(e){switch(e){case"PCA1":return function(e,t){return Math.abs(e.extrastat.pc1)<Math.abs(t.extrastat.pc1)?1:-1};case"skewness":return function(e,t){return Math.abs(e.stats.modeskew)<Math.abs(t.stats.modeskew)?1:-1};case"PCA2":return function(e,t){return Math.abs(e.extrastat.pc2)<Math.abs(t.extrastat.pc2)?1:-1};case"outlier":return function(e,t){return e.extrastat.outlier<t.extrastat.outlier?1:-1}}}function k(e,t){e.mark="bar",e.encoding={x:{field:t.field,type:t.type},y:{aggregate:"count",field:"*"}},"quantitative"===t.type&&(e.encoding.x.bin={},e.encoding.y.type=t.type)}function A(e,t){e.mark="tick",e.encoding={x:{field:t.field,type:t.type}}}function C(e,t){e.mark="area",e.encoding={x:{bin:{},field:t.field,type:t.type},y:{aggregate:"count",field:"*",type:t.type}}}function T(e,t){e.mark="boxplot",e.encoding={x:{field:t.field,type:t.type}}}function P(e,t){for(var n=M(e,t),r=!1,a=!1,o=!1,c=0;c<n.encodings.length;c++){var l=n.encodings[c];l.autoCount!==!1&&(i.enumSpec.isEnumSpec(l.field)&&(r=!0),(i.enumSpec.isEnumSpec(l.aggregate)||i.enumSpec.isEnumSpec(l.bin)||i.enumSpec.isEnumSpec(l.timeUnit))&&(a=!0),i.enumSpec.isEnumSpec(l.channel)&&(o=!0))}var s=e.groupBy;return"auto"===e.groupBy&&(s=U.autoGroupBy=r?a?"fieldTransform":"field":"encoding"),{spec:n,groupBy:s,orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{omitTableWithOcclusion:!1,autoAddCount:(r||a||o)&&e.autoAddCount}}}function M(t,n){if(n){t=h.duplicate(t),t.transform&&t.transform.filter&&delete t.transform.filter;var a=l.getVlFilter();a&&(t.transform=t.transform||{},t.transform.filter=a)}return{data:f.data,mark:t.mark===e?"?":t.mark,transform:t.transform,encodings:r.util.keys(t.encoding).reduce(function(e,n){var a=r.util.extend({channel:s.isAnyChannel(n)?"?":n},t.encoding[n],{title:void 0});return i.enumSpec.isEnumSpec(a.field)&&(a.field={name:"f"+n,"enum":a.field["enum"]}),e.push(a),e},[]),config:t.config}}function D(e){var t=h.duplicate(e),r=null;if(t){r=(t.transform||{}).filter;var i=n.omit(t.transform||{},"filter");t=n.omit(t,"transform"),i&&(t.transform=i)}var o=a.util.mergeDeep(y(),t);return o.transform.filter=l.reset(r),o}function O(e,n){var r=t.data.map(function(t){return[t[e],t[n]]});try{var a=scagnostics(r,"leader",20);return isNaN(a.skinnyScore)?{outlyingScore:0,skewedScore:0,sparseScore:0,clumpyScore:0,striatedScore:0,convexScore:0,skinnyScore:0,stringyScore:0,monotonicScore:0}:{outlyingScore:a.outlyingScore,skewedScore:a.skewedScore,sparseScore:a.sparseScore,clumpyScore:a.clumpyScore,striatedScore:a.striatedScore,convexScore:a.convexScore,skinnyScore:a.skinnyScore,stringyScore:a.stringyScore,monotonicScore:a.monotonicScore}}catch(i){return{outlyingScore:0,skewedScore:0,sparseScore:0,clumpyScore:0,striatedScore:0,convexScore:0,skinnyScore:0,stringyScore:0,monotonicScore:0}}}var _=n.keys(g.schema.definitions.Encoding.properties).concat([e+0]),U={dataencde:null,alternatives:[],autoGroupBy:null,spec:null,firstrun:!0,chart:null,charts:[],mainfield:null,prop:null};U.plot=function(e,r){if(!Object.keys(f.data).length)return U;if(!U.firstrun&&t.currentDataset[Object.keys(f.data)[0]]==f.data[Object.keys(f.data)[0]])return U;if(console.log("PLOT!!!!"),U.firstrun=!1,"undefined"!=typeof e){var a=n.cloneDeep(e),i={top:5,right:5,bottom:5,left:5},o=$(".biplot").width()-i.left-i.right,c=$(".biplot").width()-i.top-i.bottom,l=0*Math.PI,d=d3.scale.category10(),p=d3.scale.linear().range([o,0]),g=d3.scale.linear().range([c,0]),h=3,m=d3.select("#bi-plot").attr("width",o+i.left+i.right).attr("height",c+i.top+i.bottom),y=m.select("#bi-plot-g").attr("transform","translate("+i.left+","+i.top+")"),w=y.select("#bi-plot-axis"),x=y.select("#bi-plot-point"),E=null,k=[],A=[],C=[];if(0===r){k=Object.keys(a[0]),A=b(a);var C=k.map(function(e,t){var n=0,r=A.map(function(e){return e[t]}),a=ss.quantile(r,.25),i=ss.quantile(r,.75),o=1.5*(i-a);return r.forEach(function(e){(e<a-o||e>i+o)&&n++}),n})}else E=Object.keys(a),k=Object.keys(a[E[0]]),a=d3.values(a),A=a.map(function(e){return d3.values(e)});var T=new PCA;A=T.scale(A,!0,!0);var P=T.pca(A,2),M=P[0],D=P[1],O=P[2],_=0;M.forEach(function(e){_=Math.max(_,Math.abs(e[0]),Math.abs(e[1]))}),p.domain([-_,_]).nice(),g.domain([-_,_]).nice();var N=0;D.forEach(function(e){N=Math.max(N,Math.sqrt(e[0]*e[0]+e[1]*e[1]))}),N=_/N,a.map(function(e,t){e[k[0]],e.pc1=M[t][O[0]],e.pc2=M[t][O[1]]});var B=k.map(function(e,t){return{brand:e,pc1:D[t][O[0]]*N,pc2:D[t][O[1]]*N}});a.map(function(e,t){var n=S(e.pc1,e.pc2,l);e.pc1=n.x,e.pc2=n.y,e.vector=A[t]}),B.map(function(e,n){var a=S(e.pc1,e.pc2,l);e.pc1=a.x,e.pc2=a.y,0===r&&(e.outlier=C[n],e.skew=t.schema.fieldSchema(e.brand).stats.modeskew)}),U.estimate(B,r);var I=function(e,t){B.forEach(function(t,n){var r={x:0,y:0},a={x:t.pc1,y:t.pc2},i={x:e.pc1,y:e.pc2};t.D=v(r,a,i)}),y.selectAll(".tracer").data(B).enter().append("line").attr("class","tracer tips").attr("x1",function(t,n){return p(e.pc1)}).attr("y1",function(t,n){return g(e.pc2)}).attr("x2",function(e,t){return p(e.D.x)}).attr("y2",function(e,t){return g(e.D.y)}).style("stroke",function(e){return"#ff6f2b"}),delete e.D;var r=n.cloneDeep(e);delete r.pc1,delete r.pc2,delete r.vector;var a=d3.entries(r);console.log(e),V.show(a,"")},R=function(e,t){a.forEach(function(t,n){var r={x:0,y:0},a={x:e.pc1,y:e.pc2},i={x:t.pc1,y:t.pc2};t.D=v(r,a,i)});var n=y.selectAll(".tracer").data(a).enter();n.append("line").attr("class","tracer tips").attr("x1",function(e,t){return p(e.D.x)}).attr("y1",function(e,t){return g(e.D.y)}).attr("x2",function(e,t){return p(e.pc1)}).attr("y2",function(e,t){return g(e.pc2)}).style("stroke",function(e){return"#aaa"}),n.append("circle").attr("class","tracer-c tips").attr("cx",function(e,t){return p(e.D.x)}).attr("cy",function(e,t){return g(e.D.y)}).attr("r",5).style("fill",function(e){return"#ff6f2b"}).style("fill-opacity",.1);var r="";V.show(r,e.brand)},q=function(e,t){y.selectAll(".tracer").remove(),y.selectAll(".tracer-c").remove(),V.hide()},F=x.selectAll(".dot").data(a).attr("cx",function(e){return p(e.pc1)}).attr("cy",function(e){return g(e.pc2)}).style("fill",function(e){return"#161616"}).style("fill-opacity",.4).on("mouseover",I).on("mouseleave",q);F.exit().remove(),F.enter().append("circle").attr("class","dot").attr("r",h).attr("cx",function(e){return p(e.pc1)}).attr("cy",function(e){return g(e.pc2)}).style("fill",function(e){return"#161616"}).style("fill-opacity",.4).on("mouseover",I).on("mouseleave",q);var Q=w.selectAll(".circle_brand").data(B).attr("x",function(e){return p(e.pc1)-2.5}).attr("y",function(e){return g(e.pc2)-2.5}).style("fill",function(e){return d(e.brand)});Q.exit().remove(),Q.enter().append("rect").attr("class","circle_brand").attr("width",5).attr("height",5).attr("x",function(e){return p(e.pc1)-2.5}).attr("y",function(e){return g(e.pc2)-2.5}).style("fill",function(e){return d(e.brand)});var L,H,G=d3.behavior.drag().on("dragstart",function(e){H=t.schema.fieldSchema(e.brand);var n=d3.selectAll($("[id='"+e.brand+"']")).select("div"),r={field:H.field,title:H.title,type:H.type,aggregate:H.aggregate};s.dragStart(r,null);var a=n.select("span").html();L=d3.select("bi-plot").append("span").html(a),L.attr("class","pill draggable full-width no-right-margin field-info ng-pristine ng-untouched ng-valid ng-isolate-scope ui-draggable ui-draggable-handle ng-empty ui-draggable-dragging").style("position","absolute").style("z-index","9999").style("left",function(){return(d3.event.x||d3.event.pageX)+"px"}).style("top",function(){var e=(d3.event.y||d3.event.pageY)+100;return e+"px"}),d3.selectAll(".field-drop").attr("class","field-drop ng-pristine ng-untouched ng-valid ui-droppable ng-not-empty ui-dropable-active drop-active "),u.notify()}).on("drag",function(e){L.style("left",function(){return d3.event.x+"px"}).style("top",function(){return d3.event.y+100+"px"})}).on("dragend",function(e){d3.selectAll("schema-list-item").data(t.schema.fieldSchemas).filter(function(t){return t.field==e.brand}).select("div").attr("class","schema-list-item ng-pristine ng-untouched ng-valid ui-droppable ui-droppable-disabled ng-empty");s.dragStop,s.dragStop;var n=L.node().getBoundingClientRect();L.remove();var r=d3.selectAll(".shelf-group");r=r[0];var r=r.filter(function(e,t){var r=e.getBoundingClientRect();return r.top<n.top&&r.bottom>n.top&&r.left<n.left&&r.right>n.left});try{var a=$(r[0]).attr("channel-id").replace(/'/g,"");null!=a&&(s.set(a,H),s.listener.dragDrop(a))}catch(i){}u.notify(),d3.selectAll("div [d3-over='true']").attr("d3-over","false"),d3.selectAll(".field-drop").attr("class","field-drop ng-pristine ng-untouched ng-valid ui-droppable ng-not-empty")}),W=w.selectAll(".line").data(B).attr("x1",function(e){return p(0)}).attr("y1",function(e){return p(0)}).attr("x2",function(e){return p(e.pc1)}).attr("y2",function(e){return g(e.pc2)}).style("stroke",function(e){return d(e.brand)}).style("stroke-width","1px").on("mouseover",R).on("mouseleave",q).on("dblclick",function(e){var t=d3.selectAll($("[id='"+e.brand+"']")).select("div").select("span");$(t[0]).trigger("dblclick")}).call(G);W.exit().remove(),W.enter().append("line").attr("class","line square draggable").attr("x1",function(e){return p(0)}).attr("y1",function(e){return p(0)}).attr("x2",function(e){return p(e.pc1)}).attr("y2",function(e){return g(e.pc2)}).style("stroke",function(e){return d(e.brand)}).style("stroke-width","1px").on("mouseover",R).on("mouseleave",q).on("dblclick",function(e){var t=d3.selectAll($("[id='"+e.brand+"']")).select("div").select("span");$(t[0]).trigger("dblclick")}).call(G);var V=d3.tip().attr("class","d3-tip tips ").offset([10,20]).direction("e").html(function(e,t){var n="";n+="<h3>"+(1==t.length?"Brand ":"")+t+"</h3>",n+="<table>";for(var r=0;r<e.length;r++)"pc1"!=e[r].key&&"pc2"!=e[r].key&&(n+="<tr>",n+="<td>"+e[r].key+"</td>",n+="<td class=pct>"+e[r].value+"</td>");return n+="</table>"});y.call(V),U.dataencde=a}return U},U.estimate=function(e,n){if(0==n){t.schema.fieldSchemas.forEach(function(t){var n=e.find(function(e){return e.brand==t.field});t.extrastat={pc1:n.pc1,pc2:n.pc2,outlier:n.outlier}});var r=[],a=e.sort(function(e,t){return Math.abs(e.pc1)<Math.abs(t.pc1)?1:-1})[0].brand;e.sort(function(e,t){return Math.abs(e.pc2)<Math.abs(t.pc2)?1:-1});var i=e[0].brand!=a?e[0].brand:e[1].brand;r.push(a),r.push(i),t.schema.fieldSchemas.sort(function(e,t){Math.abs(e.stats.modeskew)>Math.abs(t.stats.modeskew)?-1:1});var o=t.schema.fieldSchemas.filter(function(e){var t=!1;return r.forEach(function(n){t|=n!=e}),t})[0];t.schema.fieldSchemas.sort(function(e,t){});var c=t.schema.fieldSchemas.filter(function(e){var t=!1;return r.forEach(function(n){t|=n!=e}),t})[0],l=t.schema.fieldSchema(a),s=t.schema.fieldSchema(i);w(l,"PCA1"),w(s,"PCA2"),w(o,"skewness"),w(c,"outlier")}},U.updateSpec=function(e){var r=e=n.cloneDeep(e);switch(r.ranking=E(e.type),e.mark){case"bar":k(r.mspec,t.schema.fieldSchemas[0]);break;case"tick":A(r.mspec,t.schema.fieldSchemas[0]);break;case"area":C(r.mspec,t.schema.fieldSchemas[0]);break;case"boxplot":T(r.mspec,t.schema.fieldSchemas[0])}r.charts=t.schema.fieldSchemas.sort(r.ranking).map(function(e){return N(e,r.mark,r.mspec)}),r.previewcharts=r.charts.map(function(e){var t=n.cloneDeep(e);return t.vlSpec.config={cell:{width:100,height:30},axis:{grid:!1,ticks:!1,labels:!1,titleOffset:20},overlay:{line:!0},scale:{useRawDomain:!0}},t}),r.pos=0,U.updateguide(r)};var N=function(e,r,a){var o=n.cloneDeep(a);switch(o.config={overlay:{line:!0},scale:{useRawDomain:!0}},r){case"bar":k(o,e);break;case"tick":A(o,e);break;case"area":C(o,e);break;case"boxplot":T(o,e)}var c=P(o),l=i.query(c,t.schema),s=l.result.getTopSpecQueryModel();return p.getChart(s)};return U.parseSpec=function(e){U.spec=D(e)},U.updateguide=function(e){e=n.cloneDeep(e||U.prop),e.mspec.config={},U.prop=e},U.calscagnotic=function(e){e.forEach(function(e){t.schema.fieldSchemas.forEach(function(n){if(n.field!==e&&(void 0===n.scag||void 0===n.scag[e])){var r=O(e,n.field);void 0===n.scag&&(n.scag={}),n.scag[e]=r,void 0===t.schema.fieldSchema(e).scag&&(t.schema.fieldSchema(e).scag={}),t.schema.fieldSchema(e).scag[n.field]=r}})})},U.reset=function(e){var t=y();t.transform.filter=l.reset(null,e),U.spec=t,U.firstrun=!0,U.charts.length=0,U.chart=null,U.prop=null},U.reset(),t.onUpdate.push(function(){U.reset(!0)}),U}]),angular.module("vlui").service("GuidePill",["ANY",function(e){function t(e){}function n(e){return r.pills[e]}var r={get:n,set:t,pills:{},listener:null};return["add","select","preview","update","reset","sort"].forEach(function(e){r[e]=function(){if(r.listener&&r.listener[e])return r.listener[e].apply(null,arguments)}}),r}]),angular.module("voyager2").service("Alternatives",["ANY","vl","cql","util","Chart","Dataset",function(e,t,n,r,a,i){function o(e,t,n){var a={type:"histograms",title:"Univariate Summaries",limit:20,query:m(e)};return[r.extend(a,{charts:l(a,t,n)})]}function c(e,r,a){var i=n.query.spec.isAggregate(e.spec),o=[],c=!1;e.spec.encodings.forEach(function(e){e.type===t.type.TEMPORAL&&(c=!0)});var s=r.vlSpec,u=!s.encoding.x||!s.encoding.y,d=s.encoding.color||s.encoding.size||s.encoding.shape||s.encoding.opacity,p=!s.encoding.row||!s.encoding.column;return i||o.push({type:"summarize",title:"Summaries",filterGroupBy:S,limit:2}),u&&o.push({type:"addQuantitativeField",title:"Add Quantitative Field"}),!u&&d||o.push({type:"addCategoricalField",title:"Add Categorical Field"}),u||d||o.push({type:"addQuantitativeField",title:"Add Quantitative Field"}),!c&&u&&o.push({type:"addTemporalField",title:"Add Temporal Field"}),o.push({type:"alternativeEncodings",title:"Alternative Encodings",filterGroupBy:v}),!u&&d&&p&&o.push({type:"addCategoricalField",title:"Add Categorical Field"}),o.map(function(t){return t.query=y[t.type](e),t.charts=l(t,r,a),t})}function l(e,t,r){var o=n.query(e.query,i.schema);return o.result.items.filter(function(n){var a=n.getTopSpecQueryModel();return!t||!t.shorthand||a.toShorthand(e.filterGroupBy)!==r.toShorthand(e.filterGroupBy)}).map(a.getChart)}function s(e){return n.enumSpec.isEnumSpec(e)?e:n.enumSpec.SHORT_ENUM_SPEC}function u(e){var t=r.duplicate(e.spec);return t.mark=s(t.mark),t.encodings.forEach(function(e){e.channel=s(e.channel)}),{spec:t,groupBy:"encoding",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"]}}function d(e){var a=r.duplicate(e.spec);return a.mark=s(a.mark),a.encodings=a.encodings.reduce(function(e,r){if(n.enumSpec.isEnumSpec(r.type))r.aggregate=s(r.aggregate),r.bin=s(r.bin),r.timeUnit=s(r.timeUnit);else switch(r.type){case t.type.Type.QUANTITATIVE:if("count"===r.aggregate)return e;r.aggregate=s(r.aggregate),r.bin=s(r.bin),r.hasFn=!0;break;case t.type.Type.TEMPORAL:r.timeUnit=s(r.timeUnit)}return e.concat(r)},[]),{spec:a,groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0,omitRaw:!0}}}function p(e){var a=r.duplicate(e.spec);return a.mark=s(a.mark),a.encodings=a.encodings.filter(function(e){return"count"!==e.aggregate}).map(function(e){return(n.enumSpec.isEnumSpec(e.type)||e.type===t.type.Type.QUANTITATIVE)&&(delete e.aggregate,delete e.bin),e}),{spec:a,groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!1,omitAggregate:!0}}}function f(e){var a=r.duplicate(e.spec);return a.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.NOMINAL}),{spec:a,
groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function g(e){var a=r.duplicate(e.spec);return a.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,bin:n.enumSpec.SHORT_ENUM_SPEC,aggregate:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.QUANTITATIVE}),{spec:a,groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function h(e){var a=r.duplicate(e.spec);return a.encodings.push({channel:n.enumSpec.SHORT_ENUM_SPEC,hasFn:!0,timeUnit:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,type:t.type.Type.TEMPORAL}),{spec:a,groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}}}function m(e){return{spec:{data:e.spec.data,mark:n.enumSpec.SHORT_ENUM_SPEC,transform:e.spec.transform,encodings:[{channel:n.enumSpec.SHORT_ENUM_SPEC,field:n.enumSpec.SHORT_ENUM_SPEC,bin:n.enumSpec.SHORT_ENUM_SPEC,timeUnit:n.enumSpec.SHORT_ENUM_SPEC,type:n.enumSpec.SHORT_ENUM_SPEC},{channel:n.enumSpec.SHORT_ENUM_SPEC,field:"*",aggregate:t.aggregate.AggregateOp.COUNT,type:t.type.Type.QUANTITATIVE}]},groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!1}}}var y={alternativeEncodings:u,summarize:d,disaggregate:p,addCategoricalField:f,addQuantitativeField:g,addTemporalField:h,histograms:m,getHistograms:o,getAlternatives:c},v=[n.property.Property.FIELD,n.property.Property.AGGREGATE,n.property.Property.BIN,n.property.Property.TIMEUNIT,n.property.Property.TYPE,{property:n.property.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}],S=[n.property.Property.FIELD,n.property.Property.AGGREGATE,n.property.Property.BIN,n.property.Property.TIMEUNIT,n.property.Property.TYPE];return y}]),angular.module("voyager2").controller("MainCtrl",["$scope","$document","Spec","Dataset","Wildcards","Config","consts","Chronicle","Logger","Bookmarks","Modals","FilterManager","NotifyingService","PCAplot",function(e,t,n,r,a,i,o,c,l,s,u,d,p,f){e.Spec=n,e.Dataset=r,e.Wildcards=a,e.Config=i,e.Logger=l,e.Bookmarks=s,e.FilterManager=d,e.consts=o,e.showDevPanel=!1,e.embedded=!!o.embeddedData,e.hideExplore=!1,e.fieldShow=!1,e.WildcardsShow=!1,e.PCAplot=f,e.showEncoding=!1,e.showExtraGuide=!1,e.fieldAdd=function(e){Pills.add(e)},e.toggleHideExplore=function(){e.hideExplore=!e.hideExplore,e.hideExplore?l.logInteraction(l.actions.TOGGLE_HIDE_ALTERNATIVES,n.chart.shorthand):l.logInteraction(l.actions.TOGGLE_SHOW_ALTERNATIVES,n.chart.shorthand)},e.alternativeType=null,e.setAlternativeType=function(t,r){e.alternativeType=t,r||(e.hideExplore=!1,l.logInteraction(l.actions.TOGGLE_SHOW_ALTERNATIVES,n.chart.shorthand),l.logInteraction(l.actions.SET_ALTERNATIVES_TYPE,t,{shorthand:n.chart.shorthand}))},e.scrollToTop=function(){t.find(".vis-pane-container").scrollTop(0)},e.groupByChanged=function(){l.logInteraction(l.actions.GROUP_BY_CHANGED,n.spec.groupBy)},e.autoAddCountChanged=function(){l.logInteraction(l.actions.AUTO_ADD_COUNT_CHANGED,n.spec.autoAddCount)},e.$watch("Spec.alternatives",function(t){for(var n=0;n<t.length;n++)if(e.alternativeType===t[n].type)return;e.setAlternativeType(null,!0)}),e.$watch("PCAplot"),e.canUndo=!1,e.canRedo=!1,e.showModal=function(e){u.open(e),"bookmark-list"==e&&l.logInteraction(l.actions.BOOKMARK_OPEN)},s.isSupported&&s.load(),e.embedded&&(r.dataset={values:o.embeddedData,name:"embedded"}),p.subscribe(e,function(){e.$apply()}),r.update(r.dataset).then(function(){i.updateDataset(r.dataset),console.log(i),o.initialSpec&&(n.parseSpec(o.initialSpec),f.parseSpec(o.initialSpec)),e.chron=c.record("Spec.spec",e,!0,["Dataset.dataset","Config.config","FilterManager.filterIndex"]),e.canUndoRedo=function(){e.canUndo=e.chron.canUndo(),e.canRedo=e.chron.canRedo()},e.chron.addOnAdjustFunction(e.canUndoRedo),e.chron.addOnUndoFunction(e.canUndoRedo),e.chron.addOnRedoFunction(e.canUndoRedo),e.chron.addOnUndoFunction(function(){l.logInteraction(l.actions.UNDO)}),e.chron.addOnRedoFunction(function(){l.logInteraction(l.actions.REDO)}),angular.element(t).on("keydown",function(t){return t.keyCode!=="Z".charCodeAt(0)||!t.ctrlKey&&!t.metaKey||t.shiftKey?t.keyCode==="Y".charCodeAt(0)&&(t.ctrlKey||t.metaKey)?(e.chron.redo(),e.$digest(),!1):t.keyCode==="Z".charCodeAt(0)&&(t.ctrlKey||t.metaKey)&&t.shiftKey?(e.chron.redo(),e.$digest(),!1):void 0:(e.chron.undo(),e.$digest(),!1)})})}]),angular.module("voyager2").run(["$templateCache",function(e){e.put("app/main/main.html",'<div ng-controller="MainCtrl" class="flex-root vflex full-width full-height"><div class="full-width no-shrink"><div class="card top-card no-right-margin no-top-margin"><div class="hflex"><div id="logo"></div><div class="pane"><div class="controls"><a ng-show="Bookmarks.isSupported" class="command" ng-click="showModal(\'bookmark-list\')"><i class="fa fa-bookmark"></i> Bookmarks ({{Bookmarks.list.length}})</a> <a class="command" ng-click="chron.undo()" ng-class="{disabled: !canUndo}"><i class="fa fa-undo"></i> Undo</a> <a class="command" ng-click="chron.redo()" ng-class="{disabled: !canRedo}"><i class="fa fa-repeat"></i> Redo</a></div></div><div class="absolute-top-right"><a href="http://www.myweb.ttu.edu/tnhondan/iDVL/" target="_blank" class="iDVL-logo"></a></div></div></div><alert-messages></alert-messages></div><div class="hflex full-width main-panel grow-1"><div class="pane data-pane noselect"><div class="card no-top-margin data-card abs-100"><div class="sidebar-header" ng-if="!embedded"><h2>Data</h2><dataset-selector class="right"></dataset-selector><div class="current-dataset" title="{{Dataset.currentDataset.name}}"><i class="fa fa-database"></i> <span class="dataset-name">{{Dataset.currentDataset.name}}</span></div></div><h3>Biplot</h3><bi-plot></bi-plot><div class="scroll-y-nox scroll-y"><h3>Guide plot</h3><vl-plot-group ng-if="PCAplot.chart" class="main-vl-plot-group card no-shrink guideplot" ng-repeat="chart in PCAplot.charts" ng-dblclick="chart.guideon(chart.prop)" chart="chart" show-bookmark="false" show-debug="false" show-select="true" show-axis-prop="false" show-sort="false" show-transpose="false" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="false" style="{max-height:80px}"></vl-plot-group><div class="hflex full-width"><h3>Fields</h3><div class="header-drop active"><i class="fa fa-caret-down droplist" ng-click="fieldShow = !fieldShow"></i></div></div><div ng-show="fieldShow"><schema-list field-defs="Dataset.schema.fieldSchemas" order-by="Dataset.fieldOrder" show-count="true" filter-manager="FilterManager" show-add="true"></schema-list></div><div class="hflex full-width"><h3>Wildcards</h3><div class="header-drop active"><i class="fa fa-caret-down droplist" ng-click="WildcardsShow = !WildcardsShow"></i></div></div><div ng-show="WildcardsShow"><schema-list field-defs="Wildcards.list" show-add="true" show-drop="true"></schema-list></div><div id="footer"><ul class="menu"><span ng-show="consts.debug"><li><a class="debug" ng-click="showDevPanel = !showDevPanel">Debug</a></li><li><a ng-href="{{ {spec:Spec.chart.vlSpec} | reportUrl }}" target="_blank" class="debug">Report an issue</a></li></span></ul></div></div></div></div><div class="pane encoding-pane" ng-hide="PCAplot.prop && !showEncoding"><shelves spec="Spec.spec" filter-manager="FilterManager" preview="false" support-any="true"></shelves><shelves class="preview" ng-show="Spec.previewedSpec" spec="Spec.previewedSpec || Spec.emptySpec" preview="true" support-any="true"></shelves></div><button class="toggleEncoding" ng-show="PCAplot.prop" ng-click="showEncoding=!showEncoding"></button><div class="pane vis-pane"><div class="vis-pane-container abs-100" ng-class="{\'scroll-y\': !hideExplore || !Spec.isSpecific, \'no-scroll-y\': hideExplore && Spec.isSpecific}"><slide-graph ng-if="PCAplot.prop" charts="PCAplot.prop.charts" pos="PCAplot.prop.pos"></slide-graph><div class="specified-vis-pane vflex card" ng-if="Spec.isSpecific" ng-class="{expand: hideExplore, \'no-scroll-y\': hideExplore}"><h2>Specified View</h2><vl-plot-group ng-if="!Spec.isEmptyPlot && Spec.chart" class="main-vl-plot-group card" ng-class="{\'no-scroll-y\': hideExplore}" chart="Spec.chart" show-bookmark="true" show-debug="true" show-axis-prop="true" show-sort="true" show-transpose="true" always-scrollable="hideExplore" overflow="true" show-label="true" tooltip="true" toggle-shelf="true"></vl-plot-group><div ng-if="Spec.isEmptyPlot">No specified visualization yet. Start exploring by dragging a field to encoding pane on the left or examining univariate summaries below.</div></div><div class="queried-vis-pane no-top-margin card" ng-if="!Spec.isSpecific"><div class="right"><span>({{Spec.groupByLabel[Spec.autoGroupBy]}})</span> <span style="display: inline-block; width: 10px">&nbsp;</span> <label><input type="checkbox" ng-model="Spec.spec.autoAddCount" ng-change="autoAddCountChanged()"> Auto-Add Count</label></div><h2>Guide plot<span ng-show="PCAplot.charts.length>1">s</span></h2><h2>Specified View<span ng-show="Spec.charts.length>1">s</span></h2><vl-plot-group-list ng-if="Spec.charts" charts="Spec.charts" enable-pills-preview="true" priority="1000" list-title="\'Results\'" hide-list-title="true" post-select-action="scrollToTop()" initial-limit="12"></vl-plot-group-list><div ng-if="!Spec.charts">No visualizations satisfy your encoding specification. You might want to undo last change or further modify the specification.</div></div><div class="alternatives-pane card" ng-class="{collapse: hideExplore}" ng-if="Spec.isSpecific"><div class="alternatives-header"><div class="right alternatives-jump"><a ng-if="!hideExplore && Spec.alternatives.length > 1" ng-click="setAlternativeType(null)" ng-class="{active: alternativeType===null}">All</a> <a ng-repeat="alternative in Spec.alternatives" ng-if="alternative.charts.length" ng-click="$parent.setAlternativeType(alternative.type);" md-parent-scope="this" ng-class="{active: $parent.alternativeType === alternative.type}">{{alternative.title}}</a> <a class="toggle-hide-explore" ng-click="toggleHideExplore()"><span ng-show="hideExplore">Show <i class="fa fa-toggle-up"></i></span> <span ng-show="!hideExplore">Hide <i class="fa fa-toggle-down"></i></span></a></div><h2>Related Views</h2></div><div class="alternatives-content" ng-if="!hideExplore"><vl-plot-group-list ng-repeat="alternative in Spec.alternatives" ng-if="alternative.charts.length > 0 && (!$parent.alternativeType || $parent.alternativeType === alternative.type)" id="alternatives-{{alternative.type}}" list-title="alternative.title" charts="alternative.charts" enable-pills-preview="true" priority="$index * 1000" initial-limit="alternative.limit || null" post-select-action="$parent.scrollToTop()" show-query-select="true" query="alternative.query"></vl-plot-group-list></div></div></div></div><div class="pane guidemenu grow-1" ng-if="showExtraGuide||PCAplot.prop"><guide-menu prop="PCAplot.prop" priority="2" initial-limit="5"></guide-menu></div></div><div class="hflex full-width dev-panel" ng-if="showDevPanel"><div class="pane" ng-show="consts.logToWebSql"><div class="card"><div>userid: {{Logger.userid}}</div><button ng-click="Logger.clear()">Clear logs</button><br><button ng-click="Logger.export()">Download logs</button></div></div><div class="pane config-pane"><div class="card scroll-y abs-100"><configuration-editor></configuration-editor></div></div><div class="pane vl-pane"><cql-query-editor></cql-query-editor></div><div class="pane vg-pane"><vg-spec-editor></vg-spec-editor></div></div><bookmark-list highlighted="Fields.highlighted" post-select-action="scrollToTop"></bookmark-list><dataset-modal></dataset-modal></div>'),e.put("components/configurationeditor/configurationeditor.html","<form><pre>{{ Config.config | compactJSON }}</pre></form>"),e.put("components/cqlQueryEditor/cqlQueryEditor.html",'<div class="card scroll-y abs-100 vflex"><div><div class="right command"><a ui-zeroclip="" zeroclip-model="Spec.query | compactJSON">Copy</a></div><h3>CompassQL Query</h3></div><textarea class="cqlquery flex-grow-1 full-height" json-input="" type="text" ng-model="Spec.cleanQuery"></textarea></div>'),e.put("components/d3-biplot/bi-plot.html",'<svg id="bi-plot" width="100%" class="biplot"><g id="bi-plot-g"><g id="bi-plot-axis"></g><g id="bi-plot-point"></g></g></svg>'),e.put("components/d3-guideplot/gplot.html",'<div class="gplot" ng-click="explore()"><svg class="gplotSvg" id="gplot{{pcaDef}}"></svg></div>'),e.put("components/d3-guideplot/guide-plot.html",'<div id="guide-plot-group" class="guideplot"><g-plot ng-repeat="pcaDef in pcaDefs" pca-def="pcaDef" id="{{pcaDef}}"></g-plot></div>'),e.put("components/guidemenu/guideMenu.html",'<div class="contain"><div class="headermenu"><h2>You just select</h2><div><select class="typeselect" ng-model="prop.type" ng-options="type for type in props" ng-change="typeChange()"></select><select class="markselect" ng-model="prop.mark" ng-options="type for type in marks" ng-change="markChange()"></select></div></div><div class="thum"><div class="scroll-y"><vl-plot-group ng-if="prop.previewcharts" class="main-vl-plot-group card" ng-repeat="chart in prop.previewcharts" ng-click="previewSlider($index)" chart="chart" show-bookmark="false" show-debug="false" show-select="false" show-axis-prop="true" show-sort="false" show-transpose="false" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="false" priority="priority * $index" style="{max-height:80px}"></vl-plot-group></div></div></div>'),e.put("components/d3-slidegraph/slide-com.html",'<li class="item wrap"><vl-plot-group class="item" chart="chart" show-bookmark="true" show-debug="true" show-select="true" show-axis-prop="true" show-sort="false" show-transpose="true" enable-pills-preview="true" always-scrollable="false" overflow="false" show-label="false" tooltip="true" toggle-shelf="true"></vl-plot-group></li>'),e.put("components/d3-slidegraph/slide-graph.html",'<div class="slideGraph card no-top-margin"><h2>Guide plot explore</h2><div class="wrap"><button class="butSlider" ng-click="prev()"><i class="fa fa-angle-double-up"></i></button><div class="scroller"><ul class="items-slider"><slide-com ng-repeat="chart in charts" chart="chart"></slide-com></ul></div><button class="butSlider" ng-click="next()"><i class="fa fa-angle-double-down"></i></button></div></div>'),e.put("components/vgSpecEditor/vgSpecEditor.html",'<div class="card scroll-y abs-100 vflex no-right-margin"><div><div class="right"><a class="command" ui-zeroclip="" zeroclip-model="Spec.chart.vgSpec | compactJSON">Copy</a><lyra-export></lyra-export></div><h3>Vega Specification</h3></div><textarea class="vgspec flex-grow-1" json-input="" disabled="disabled" type="text" ng-model="Spec.chart.vgSpec"></textarea></div>')}]);